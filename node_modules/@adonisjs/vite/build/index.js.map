{"version":3,"sources":["../stubs/main.ts","../configure.ts","../src/define_config.ts"],"sourcesContent":["/*\n * @adonisjs/vite\n *\n * (c) AdonisJS\n *\n * For the full copyright and license information, please view the LICENSE\n * file that was distributed with this source code.\n */\n\nimport { getDirname } from '@poppinss/utils'\nexport const stubsRoot = getDirname(import.meta.url)\n","/*\n * @adonisjs/vite\n *\n * (c) AdonisJS\n *\n * For the full copyright and license information, please view the LICENSE\n * file that was distributed with this source code.\n */\n\nimport type Configure from '@adonisjs/core/commands/configure'\n\nimport { stubsRoot } from './stubs/main.js'\n\n/**\n * Configures the package\n */\nexport async function configure(command: Configure) {\n  const codemods = await command.createCodemods()\n  let shouldInstallPackages: boolean | undefined = command.parsedFlags.install\n\n  /**\n   * Publish stubs\n   */\n  await codemods.makeUsingStub(stubsRoot, 'config/vite.stub', {})\n  await codemods.makeUsingStub(stubsRoot, 'vite.config.stub', {})\n  await codemods.makeUsingStub(stubsRoot, 'js_entrypoint.stub', {})\n\n  /**\n   * Update RC file\n   */\n  await codemods.updateRcFile((rcFile) => {\n    rcFile.addProvider('@adonisjs/vite/vite_provider')\n    rcFile.addMetaFile('public/**', false)\n    rcFile.addAssemblerHook('onBuildStarting', '@adonisjs/vite/build_hook')\n  })\n\n  /**\n   * Add server middleware\n   */\n  await codemods.registerMiddleware('server', [\n    { path: '@adonisjs/vite/vite_middleware', position: 'after' },\n  ])\n\n  /**\n   * Prompt when `install` or `--no-install` flags are\n   * not used\n   */\n  if (shouldInstallPackages === undefined) {\n    shouldInstallPackages = await command.prompt.confirm('Do you want to install \"vite\"?')\n  }\n\n  /**\n   * Install dependency or list the command to install it\n   */\n  if (shouldInstallPackages) {\n    await codemods.installPackages([{ name: 'vite', isDevDependency: true }])\n  } else {\n    await codemods.listPackagesToInstall([{ name: 'vite', isDevDependency: true }])\n  }\n\n  /**\n   * Add `assetsBundler: false` to the adonisrc file\n   */\n  const tsMorph = await import('ts-morph')\n  const project = await codemods.getTsMorphProject()\n  const adonisRcFile = project?.getSourceFile('adonisrc.ts')\n  const defineConfigCall = adonisRcFile\n    ?.getDescendantsOfKind(tsMorph.SyntaxKind.CallExpression)\n    .find((statement) => statement.getExpression().getText() === 'defineConfig')\n\n  const configObject = defineConfigCall!\n    .getArguments()[0]\n    .asKindOrThrow(tsMorph.SyntaxKind.ObjectLiteralExpression)\n\n  configObject.addPropertyAssignment({\n    name: 'assetsBundler',\n    initializer: 'false',\n  })\n\n  await adonisRcFile?.save()\n}\n","/*\n * @adonisjs/vite\n *\n * (c) AdonisJS\n *\n * For the full copyright and license information, please view the LICENSE\n * file that was distributed with this source code.\n */\n\nimport { join } from 'node:path'\n\nimport type { ViteOptions } from './types.js'\n\n/**\n * Define the backend config for Vite\n */\nexport function defineConfig(config: Partial<ViteOptions>): ViteOptions {\n  return {\n    buildDirectory: 'public/assets',\n    assetsUrl: '/assets',\n    manifestFile: config.buildDirectory\n      ? join(config.buildDirectory, '.vite/manifest.json')\n      : 'public/assets/.vite/manifest.json',\n    ...config,\n  }\n}\n"],"mappings":";;;;;;AASA,SAAS,kBAAkB;AACpB,IAAM,YAAY,WAAW,YAAY,GAAG;;;ACMnD,eAAsB,UAAU,SAAoB;AAClD,QAAM,WAAW,MAAM,QAAQ,eAAe;AAC9C,MAAI,wBAA6C,QAAQ,YAAY;AAKrE,QAAM,SAAS,cAAc,WAAW,oBAAoB,CAAC,CAAC;AAC9D,QAAM,SAAS,cAAc,WAAW,oBAAoB,CAAC,CAAC;AAC9D,QAAM,SAAS,cAAc,WAAW,sBAAsB,CAAC,CAAC;AAKhE,QAAM,SAAS,aAAa,CAAC,WAAW;AACtC,WAAO,YAAY,8BAA8B;AACjD,WAAO,YAAY,aAAa,KAAK;AACrC,WAAO,iBAAiB,mBAAmB,2BAA2B;AAAA,EACxE,CAAC;AAKD,QAAM,SAAS,mBAAmB,UAAU;AAAA,IAC1C,EAAE,MAAM,kCAAkC,UAAU,QAAQ;AAAA,EAC9D,CAAC;AAMD,MAAI,0BAA0B,QAAW;AACvC,4BAAwB,MAAM,QAAQ,OAAO,QAAQ,gCAAgC;AAAA,EACvF;AAKA,MAAI,uBAAuB;AACzB,UAAM,SAAS,gBAAgB,CAAC,EAAE,MAAM,QAAQ,iBAAiB,KAAK,CAAC,CAAC;AAAA,EAC1E,OAAO;AACL,UAAM,SAAS,sBAAsB,CAAC,EAAE,MAAM,QAAQ,iBAAiB,KAAK,CAAC,CAAC;AAAA,EAChF;AAKA,QAAM,UAAU,MAAM,OAAO,UAAU;AACvC,QAAM,UAAU,MAAM,SAAS,kBAAkB;AACjD,QAAM,eAAe,SAAS,cAAc,aAAa;AACzD,QAAM,mBAAmB,cACrB,qBAAqB,QAAQ,WAAW,cAAc,EACvD,KAAK,CAAC,cAAc,UAAU,cAAc,EAAE,QAAQ,MAAM,cAAc;AAE7E,QAAM,eAAe,iBAClB,aAAa,EAAE,CAAC,EAChB,cAAc,QAAQ,WAAW,uBAAuB;AAE3D,eAAa,sBAAsB;AAAA,IACjC,MAAM;AAAA,IACN,aAAa;AAAA,EACf,CAAC;AAED,QAAM,cAAc,KAAK;AAC3B;;;ACvEA,SAAS,YAAY;AAOd,SAAS,aAAa,QAA2C;AACtE,SAAO;AAAA,IACL,gBAAgB;AAAA,IAChB,WAAW;AAAA,IACX,cAAc,OAAO,iBACjB,KAAK,OAAO,gBAAgB,qBAAqB,IACjD;AAAA,IACJ,GAAG;AAAA,EACL;AACF;","names":[]}